<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Threema GmbH">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Usage - SaltyRTC Client for Java</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Usage";
    var mkdocs_page_input_path = "usage.md";
    var mkdocs_page_url = "/usage/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> SaltyRTC Client for Java</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Guide</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../installing/">Installing</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Usage</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#usage">Usage</a></li>
                
                    <li><a class="toctree-l4" href="#the-cryptoprovider">The CryptoProvider</a></li>
                
                    <li><a class="toctree-l4" href="#the-saltyrtcbuilder">The SaltyRTCBuilder</a></li>
                
                    <li><a class="toctree-l4" href="#full-example">Full example</a></li>
                
                    <li><a class="toctree-l4" href="#trusted-keys">Trusted keys</a></li>
                
                    <li><a class="toctree-l4" href="#event-handlers">Event handlers</a></li>
                
                    <li><a class="toctree-l4" href="#dynamically-determine-server-connection-info">Dynamically determine server connection info</a></li>
                
                    <li><a class="toctree-l4" href="#logging">Logging</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../reference/">Reference</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../about/">About</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">SaltyRTC Client for Java</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Guide &raquo;</li>
        
      
    
    <li>Usage</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/saltyrtc/saltyrtc-client-java/edit/master/docs/docs/usage.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="usage">Usage</h1>
<p>This chapter gives a short introduction on how to use the SaltyRTC JavaScript client.</p>
<p>To see a more practical example, you may also want to take a look at our <a href="https://github.com/saltyrtc/saltyrtc-demo">demo
application</a>.</p>
<p>Plase note that instances of this library are not considered thread-safe. Thus, an application
using more than one thread needs to take care of synchronisation itself.</p>
<h2 id="the-cryptoprovider">The CryptoProvider</h2>
<p>SaltyRTC is based on the <a href="https://nacl.cr.yp.to/">NaCl</a> crypto system, which
features both symmetric and asymmetric encryption. However, there are various
implementations of NaCl for different target systems with different performance
characteristics, therefore the crypto backend in this library is pluggable.</p>
<p>In order to instantiate a <code>SaltyRTC</code> instance or a <code>KeyStore</code>, you need to
provide an implementation of the <code>org.saltyrtc.client.crypto.CryptoProvider</code>
interface. You can find an example implementation
<a href="https://github.com/saltyrtc/saltyrtc-client-java/blob/master/src/test/java/org/saltyrtc/client/tests/LazysodiumCryptoInstance.java">in the testsuite</a>,
but depending on your target platform and requirements you should probably provide
your own.</p>
<pre><code class="java">final CryptoProvider cryptoProvider = new MyCryptoProvider();
</code></pre>

<h2 id="the-saltyrtcbuilder">The SaltyRTCBuilder</h2>
<p>To initialize a <code>SaltyRTC</code> instance, you can use the <code>SaltyRTCBuilder</code>.</p>
<pre><code class="java">import org.saltyrtc.client.SaltyRTCBuilder;

final SaltyRTCBuilder builder = new SaltyRTCBuilder(cryptoProvider);
</code></pre>

<h3 id="connection-info">Connection info</h3>
<p>Then you need to provide connection info:</p>
<pre><code class="java">builder.connectTo(host, port, sslContext);
</code></pre>

<p>For testing, you can use <a href="https://saltyrtc.org/pages/getting-started.html">our test server</a>.</p>
<h3 id="key-store">Key store</h3>
<p>The client needs to have its own public/private keypair. Create a new keypair
with the <code>KeyStore</code> class:</p>
<pre><code class="java">import org.saltyrtc.client.keystore.KeyStore;

final KeyStore keyStore = new KeyStore(cryptoProvider);
builder.withKeyStore(keyStore);
</code></pre>

<h3 id="server-key-pinning">Server key pinning</h3>
<p>If you want to use server key pinning, specify the server public permanent key:</p>
<pre><code class="java">builder.withServerKey(serverPublicPermanentKey);
</code></pre>

<p>The <code>serverPublicPermanentKey</code> can be either a byte array or a hex encoded string.</p>
<h3 id="websocket-connect-timeout">Websocket connect timeout</h3>
<p>Optionally, you can specify the Websocket connection timeout in milliseconds:</p>
<pre><code class="java">builder.withWebsocketConnectTimeout(5000);
</code></pre>

<h3 id="websocket-ping-interval">Websocket ping interval</h3>
<p>Optionally, you can specify a Websocket ping interval in seconds:</p>
<pre><code class="java">builder.withPingInterval(60);
</code></pre>

<h3 id="task-configuration">Task configuration</h3>
<p>You must initialize SaltyRTC with a task (TODO: Link to tasks documentation)
that takes over after the handshake is done.</p>
<p>For example, when using the <a href="https://github.com/saltyrtc/saltyrtc-task-webrtc-java">WebRTC task</a>:</p>
<pre><code class="java">import org.saltyrtc.client.tasks.Task;
import org.saltyrtc.tasks.webrtc.WebRTCTask;

builder.usingTasks(new Task[] { new WebRTCTask() });
</code></pre>

<h3 id="connecting-as-initiator">Connecting as Initiator</h3>
<p>If you want to connect to the server as initiator, you can use the <code>.asInitiator()</code> method:</p>
<pre><code class="java">final SaltyRTC client = builder.asInitiator();
</code></pre>

<h3 id="connecting-as-responder">Connecting as Responder</h3>
<p>If you want to connect as responder, you need to provide the initiator information first.</p>
<pre><code class="java">builder.initiatorInfo(initiatorPublicPermanentKey, initiatorAuthToken);
final SaltyRTC client = builder.asResponder();
</code></pre>

<p>The initiator public permanent key as well as the initiator auth token can be
either byte arrays or hex encoded strings.</p>
<h2 id="full-example">Full example</h2>
<p>All methods on the <code>SaltyRTCBuilder</code> support chaining. Here&rsquo;s a full example of an initiator configuration:</p>
<pre><code class="java">import javax.net.ssl.SSLContext;
import org.saltyrtc.client.SaltyRTC;
import org.saltyrtc.client.SaltyRTCBuilder;
import org.saltyrtc.client.crypto.CryptoProvider;
import org.saltyrtc.client.keystore.KeyStore;
import org.saltyrtc.tasks.webrtc.WebRTCTask;

final SSLContext sslContext = SSLContext.getDefault();
final CryptoProvider cryptoProvider = new MyCryptoProvider();
final SaltyRTC client = new SaltyRTCBuilder(cryptoProvider)
        .connectTo(Config.SALTYRTC_HOST, Config.SALTYRTC_PORT, sslContext)
        .withKeyStore(new KeyStore(cryptoProvider))
        .withPingInterval(60)
        .withWebsocketConnectTimeout(5000)
        .withServerKey(Config.SALTYRTC_SERVER_PUBLIC_KEY)
        .usingTasks(new Task[] { new WebRTCTask() })
        .asInitiator();
</code></pre>

<p>To see a more practical example, you may also want to take a look at our
<a href="https://github.com/saltyrtc/saltyrtc-demo">demo application</a>.</p>
<h2 id="trusted-keys">Trusted keys</h2>
<p>In order to reconnect to a session using a trusted key, you first need to
restore your <code>KeyStore</code> with the permanent keypair originally used to establish
the trusted session:</p>
<pre><code class="java">final KeyStore keyStore = new KeyStore(cryptoProvider, ourPrivatePermanentKey);
builder.withKeyStore(keyStore);
</code></pre>

<p>The <code>ourPrivatePermanentKey</code> can be either a byte array or a hex encoded string.</p>
<p>Then, on the <code>SaltyRTCBuilder</code> instance, set the trusted peer key:</p>
<pre><code class="java">builder.withTrustedPeerKey(peerPublicPermanentKey);
</code></pre>

<p>The <code>peerPublicPermanentKey</code> can be either a byte array or a hex encoded string.</p>
<h2 id="event-handlers">Event handlers</h2>
<p>The SaltyRTC Client for Java emits a number of events during its lifecycle.
For all events, event handlers can be registered. Please take a look at
<a href="../reference/">the reference</a> for a list of all possible events.</p>
<p>Example for registering an event handler:</p>
<pre><code class="java">client.events.signalingStateChanged.register(new EventHandler&lt;SignalingStateChangedEvent&gt;() {
    @Override
    public boolean handle(SignalingStateChangedEvent event) {
        System.out.println(&quot;Signaling state changed to &quot; + event.getState().name());
        return false; // Don't deregister this event handler
    }
};
</code></pre>

<p>Every event class in <code>client.events</code> is an <code>EventRegistry</code>. For every event,
multiple event handlers can be registered and &ndash; when desired &ndash;
deregistered.</p>
<p>To deregister event handlers, you have three options:</p>
<ul>
<li>Use the <code>event.unregister(instance)</code> method to deregister a specific
  event handler instance.</li>
<li>Return <code>true</code> from with in an event handler to remove itself from the
  event registry.</li>
<li>Use the <code>event.EVENT_NAME.clear()</code> method to remove all event handlers
  for that event.</li>
</ul>
<p>To remove all handlers for all events, use the <code>client.events.clearAll()</code>
method.</p>
<h2 id="dynamically-determine-server-connection-info">Dynamically determine server connection info</h2>
<p>Instead of specifying the SaltyRTC server host, port and SSL context directly,
you can instead provide an implementation of <code>SaltyRTCServerInfo</code> that can
dynamically determine the connection info based on the public key of the
initiator.</p>
<pre><code class="java">final SSLContext sslContext = SSLContext.getDefault();
final SaltyRTC responder = new SaltyRTCBuilder(cryptoProvider)
    .connectTo(new SaltyRTCServerInfo() {
        @Override
        public String getHost(String initiatorPublicKey) {
            if (initiatorPublicKey.startsWith(&quot;a&quot;)) {
                return &quot;a.example.org&quot;;
            } else {
                return &quot;other.example.org&quot;;
            }
        }

        @Override
        public int getPort(String initiatorPublicKey) {
            return Config.SALTYRTC_PORT;
        }

        @Override
        public SSLContext getSSLContext(String initiatorPublicKey) {
            return sslContext;
        }
    })
    // ...
</code></pre>

<h2 id="logging">Logging</h2>
<p>The library uses the <a href="https://www.slf4j.org/">slf4j</a> logging API. Configure
a logger (e.g. slf4j-simple) to see the log output.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../reference/" class="btn btn-neutral float-right" title="Reference">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../installing/" class="btn btn-neutral" title="Installing"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>© 2016-2018 Threema GmbH</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/saltyrtc/saltyrtc-client-java" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../installing/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../reference/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
